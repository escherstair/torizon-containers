.build-imx95-template:
  retry: 2
  extends: .docker-build
  rules:
    - if: $CI_WORLD_TEST == "true" || $CI_COMMIT_TAG == "true"
      when: never
    - if: $CI_WORLD_REBUILD == "true" || $CI_PIPELINE_SOURCE == "merge_request_event"
      when: always
    - if: $CI_COMMIT_REF_PROTECTED == "true"
      when: always
      variables:
        REGISTRY_NAMESPACE: $PROJECT_SETTING_REGISTRY_NAMESPACE
  variables:
    BUILD_FOR_ARM_V8: "true"

build-base-imx95:
  extends: .build-imx95-template
  before_script:
    - export DEBIAN_POINT_RELEASE="${DEBIAN_POINT_RELEASE}"
  variables:
    BUILD_FOR_ARM_V8: "true"
    BUILD_FOR_AMD64: "true"
    IMAGE_NAME: debian-imx95
    DOCKERFILE_FOLDER: "${BASE_FOLDER}/"
    TORADEX_FEED_URL: "https://feeds.toradex.com/stable/imx95/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${BASE_FOLDER}/"
  needs: []

build-wayland-base-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: debian-imx95
    IMAGE_NAME: wayland-base-imx95
    DOCKERFILE_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${WAYLAND_BASE_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${WAYLAND_BASE_FOLDER}/"
  needs: [build-base-imx95]

build-weston-imx95:
  extends: .build-imx95-template
  before_script:
    - ./${SUPPORT_FILES_FOLDER}/${WESTON_FOLDER}/make_feature_map.sh
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: weston-imx95
    DOCKERFILE_FOLDER: "${WESTON_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${WESTON_FOLDER}/"
  needs: [build-wayland-base-imx95]

build-graphics-tests-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: graphics-tests-imx95
    DOCKERFILE_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${GRAPHICS_TESTS_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${GRAPHICS_TESTS_FOLDER}/"
  needs: [build-wayland-base-imx95]

build-weston-touch-calibrator-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: weston-imx95
    IMAGE_NAME: weston-touch-calibrator-imx95
    DOCKERFILE_FOLDER: "${WESTON_TOUCH_CALIBRATOR_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${WESTON_TOUCH_CALIBRATOR_FOLDER}/"
  needs: [build-weston-imx95]

build-qt5-wayland-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: qt5-wayland-imx95
    DOCKERFILE_FOLDER: "${QT5_WAYLAND_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/qt-wayland/"
  needs: [build-wayland-base-imx95]

build-qt5-wayland-examples-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: qt5-wayland-imx95
    IMAGE_NAME: qt5-wayland-examples-imx95
    DOCKERFILE_FOLDER: "${QT5_WAYLAND_EXAMPLES_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/qt-wayland/"
  needs: [build-qt5-wayland-imx95]

build-qt6-wayland-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: qt6-wayland-imx95
    DOCKERFILE_FOLDER: "${QT6_WAYLAND_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/qt-wayland/"
  needs: [build-wayland-base-imx95]

build-qt6-wayland-examples-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: qt6-wayland-imx95
    IMAGE_NAME: qt6-wayland-examples-imx95
    DOCKERFILE_FOLDER: "${QT6_WAYLAND_EXAMPLES_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/qt-wayland/"
  needs: [build-qt6-wayland-imx95]

build-qt6-wayland-tests-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_BASE_IMAGE_NAME: wayland-base-imx95
    BASE_IMAGE_NAME: qt6-wayland-imx95
    IMAGE_NAME: qt6-wayland-tests-imx95
    DOCKERFILE_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${QT6_TESTS_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${TESTS_FOLDER}/${QT_TESTS_FOLDER}/"
  needs: [build-wayland-base-imx95, build-qt6-wayland-imx95]

build-chromium-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: chromium-imx95
    DOCKERFILE_FOLDER: "${CHROMIUM_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${CHROMIUM_FOLDER}/"
  needs: [build-wayland-base-imx95]

build-chromium-tests-imx95:
  extends: .build-imx95-template
  variables:
    BASE_IMAGE_NAME: chromium-imx95
    IMAGE_NAME: chromium-tests-imx95
    DOCKERFILE_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${CHROMIUM_TESTS_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${CHROMIUM_TESTS_FOLDER}/"
  needs: [build-chromium-imx95]

build-cog-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: cog-imx95
    DOCKERFILE_FOLDER: "${COG_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${COG_FOLDER}/"
  needs: [build-wayland-base-imx95]

build-dotnet-8-imx95:
  extends: .build-imx95-template
  before_script:
    - . ./ci-scripts/build/export-dotnet-build-args.sh ./ci-scripts/container-versions/dotnet-8.yml dotnet8-imx95
    - export DEBIAN_POINT_RELEASE="${DEBIAN_POINT_RELEASE}"
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: debian-imx95
    IMAGE_NAME: dotnet8-imx95
    DOTNET_RUNTIME: dotnet
    DOCKERFILE_FOLDER: "${DOTNET_FOLDER}/${DOTNET_BASE_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${DOTNET_FOLDER}/${DOTNET_BASE_FOLDER}/"
  needs: ["build-base-imx95"]

build-dotnet-8-asp-imx95:
  extends: .build-imx95-template
  before_script:
    - . ./ci-scripts/build/export-dotnet-build-args.sh ./ci-scripts/container-versions/dotnet-8.yml aspdotnet8-imx95
    - export DEBIAN_POINT_RELEASE="${DEBIAN_POINT_RELEASE}"
  variables:
    BUILD_FOR_ARM_V8: "true"
    BASE_IMAGE_NAME: debian-imx95
    IMAGE_NAME: aspdotnet8-imx95
    DOTNET_RUNTIME: aspnetcore
    DOCKERFILE_FOLDER: "${DOTNET_FOLDER}/${DOTNET_BASE_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${DOTNET_FOLDER}/${DOTNET_BASE_FOLDER}/"
  needs: ["build-base-imx95"]

build-dotnet-8-wayland-imx95:
  extends: .build-imx95-template
  before_script:
    - . ./ci-scripts/build/export-dotnet-build-args.sh ./ci-scripts/container-versions/dotnet-8.yml dotnet8-wayland-imx95
    - export DEBIAN_POINT_RELEASE="${DEBIAN_POINT_RELEASE}"
  variables:
    BUILD_FOR_ARM_V8: "true"
    BUILD_BASE_IMAGE_NAME: dotnet8-imx95
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: dotnet8-wayland-imx95
    DOCKERFILE_FOLDER: "${DOTNET_FOLDER}/${DOTNET_WAYLAND_BASE_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${DOTNET_FOLDER}/${DOTNET_WAYLAND_BASE_FOLDER}/"
  needs: ["build-dotnet-8-imx95", "build-wayland-base-imx95"]

build-arm64-toolchain-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BUILD_FOR_AMD64: "true"
    BASE_IMAGE_NAME: debian-imx95
    CROSS_COMPILER: aarch64-linux-gnu
    CROSS_TARGET_ARCH: arm64
    IMAGE_NAME: cross-toolchain-arm64-imx95
    DOCKERFILE_FOLDER: "${CROSS_TOOLCHAIN_FOLDER}/${BASE_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${CROSS_TOOLCHAIN_FOLDER}/${BASE_FOLDER}/"
  needs: [build-base-imx95]

build-arm64-toolchain-ssh-imx95:
  extends: .build-imx95-template
  variables:
    BUILD_FOR_ARM_V8: "true"
    BUILD_FOR_AMD64: "true"
    IMAGE_NAME: cross-toolchain-ssh-arm64-imx95
    CROSS_TARGET_ARCH: arm64
    BASE_IMAGE_NAME: cross-toolchain-arm64-imx95
    DOCKERFILE_FOLDER: "${CROSS_TOOLCHAIN_FOLDER}/${SSH_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${CROSS_TOOLCHAIN_FOLDER}/${SSH_FOLDER}/"
  needs: ["build-arm64-toolchain-imx95"]

build-wayland-gtk3-imx95:
  extends: .build-imx95-template
  variables:
    BASE_IMAGE_NAME: wayland-base-imx95
    IMAGE_NAME: wayland-gtk3-imx95
    DOCKERFILE_FOLDER: "${GTK_3_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${GTK_3_FOLDER}/"
  needs:
    - job: build-wayland-base-imx95
      optional: true

build-dotnet-8-gtk3-imx95:
  extends: .build-imx95-template
  before_script:
    - . ./ci-scripts/build/export-dotnet-build-args.sh ./ci-scripts/container-versions/dotnet-8.yml ${IMAGE_NAME}
    - export DEBIAN_POINT_RELEASE="${DEBIAN_POINT_RELEASE}"
  variables:
    BASE_IMAGE_NAME: dotnet8-wayland-imx95
    IMAGE_NAME: dotnet8-gtk3-imx95
    DOCKERFILE_FOLDER: "${GTK_3_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${GTK_3_FOLDER}/"
  needs:
    - job: build-dotnet-8-wayland-imx95
      optional: true

build-gtk3-tests-imx95:
  extends: .build-imx95-template
  variables:
    BASE_IMAGE_NAME: wayland-gtk3-imx95
    IMAGE_NAME: gtk3-tests-imx95
    DOCKERFILE_FOLDER: "${PLATFORM_SPECIFIC_FOLDER}/${IMX95_FOLDER}/${TESTS_FOLDER}/${GTK_3_TESTS_FOLDER}/"
    DOCKERFILE_BUILD_CONTEXT_FOLDER: "${SUPPORT_FILES_FOLDER}/${TESTS_FOLDER}/${GTK_3_TESTS_FOLDER}/"
  needs: [build-wayland-gtk3-imx95]
